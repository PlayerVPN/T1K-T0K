let e=!0;document.addEventListener("DOMContentLoaded",(function(){let t,n,d,i,a,o=[];if(window.addNotification=function(e){o[o.length-1]!=e&&(o.push(e),1==o.length&&showNotification())},window.showNotification=function(){0!=o.length&&(document.getElementById("notification").innerHTML=o[0],document.getElementById("notification").dataset.visible="true",setTimeout((function(){document.getElementById("notification").dataset.visible="false",o.shift(),setTimeout((function(){showNotification()}),1e3)}),3e3))},document.getElementsByClassName("videos-wrapper")[0].addEventListener("scroll",(function(){document.getElementsByClassName("videos-wrapper")[0].scrollTop>50?document.getElementsByClassName("clear-history")[0].dataset.visible="hidden":document.getElementsByClassName("clear-history")[0].dataset.visible="visible"})),window.loadVideo=async function(n){if(e)if(n.match(/\bhttps?:\/\/(?:m|www|vm|vt)\.tiktok\.com\/\S*?\b(?:(?:(?:usr|v|embed|user|video)\/|\?shareId=|\&item_id=)(\d+)|(?=\w{7})(\w*?[A-Z\d]\w*)(?=\s|\/$))\b/)||n.match(/\d+/)){document.getElementById("video").src="",document.getElementsByClassName("tt_loading")[0].style.display="flex",document.getElementById("video").style.display="none",document.getElementById("p_player").style.background="#151820",document.getElementsByClassName("ui-right")[0].style.opacity=0,document.getElementsByClassName("ui-bottom")[0].style.opacity=0,changePage("player");try{let e=await fetch("https://www.tikwm.com/api/?url="+n),d=await e.json();if(-1==d.code)return changePage("home"),void addNotification("❌ Invalid TikTok URL");if(t=d.data,window.history.pushState({},"","/video/"+t.id),document.getElementById("likes-counter").innerHTML=formatNumber(t.digg_count),document.getElementById("comment-counter").innerHTML=formatNumber(t.comment_count),document.getElementById("share-counter").innerHTML=formatNumber(t.share_count),document.getElementById("username").innerHTML=t.author.nickname,document.getElementById("description").innerHTML=formatDescription(t.title),t.music_info.cover){document.getElementById("disc-art").style.backgroundImage="url("+t.music_info.cover+")";let e=t.music_info.cover.split("_");e.pop(),e=e.join("_");let n=t.author.avatar.split("_");n.pop(),n=n.join("_"),document.getElementById("disc-art").style.transform=e==n?"scale(0.5)":"scale(1)",document.getElementById("user").style.backgroundImage="url("+t.author.avatar+")"}else document.getElementById("disc-art").style.backgroundImage="none";if(console.log(t.music_info),t.music_info.title.startsWith("original sound - ")?document.getElementsByClassName("audio-title")[0].innerHTML="original sound":document.getElementsByClassName("audio-title")[0].innerHTML=t.music_info.title,document.getElementsByClassName("audio-artist")[0].innerHTML=t.music_info.author?"-&nbsp;&nbsp;"+t.music_info.author:"",t.images&&t.images.length>0){document.getElementById("img-data").style.display="flex",document.getElementById("p_player").dataset.type="image",document.getElementById("image-slideshow").dataset.index=0,document.getElementById("img-content").innerHTML="",document.getElementById("image-slideshow").style.display="block";for(let e=0;e<t.images.length;e++)document.getElementById("img-content").innerHTML+="<img src='"+t.images[e]+"' class='image' id='image-"+e+"'>";document.getElementById("img-total").innerHTML=t.images.length}else document.getElementById("p_player").dataset.type="video",document.getElementById("img-data").style.display="none",document.getElementById("image-slideshow").style.display="none";let i=await fetch(t.play).then((e=>e.blob())),a=URL.createObjectURL(i);document.getElementById("video").onloadeddata=function(){document.getElementById("video").paused&&(document.getElementById("video-status").dataset.playing="false")},t.width>t.height?(document.getElementById("video").style.width="100%",document.getElementById("video").style.height="auto"):t.width<t.height?(document.getElementById("video").style.width="auto",document.getElementById("video").style.height="100%"):(document.getElementById("video").style.width="100%",document.getElementById("video").style.height="100%"),document.getElementById("video").src=a,document.getElementById("p_player").style.background="#000",document.getElementById("video").style.display="flex",document.getElementsByClassName("ui-right")[0].style.opacity=1,document.getElementsByClassName("ui-bottom")[0].style.opacity=1,document.getElementsByClassName("tt_loading")[0].style.display="none",document.getElementById("video-status").style.display="flex",localStorage.getItem("history")||localStorage.setItem("history",JSON.stringify([]));let o=JSON.parse(localStorage.getItem("history"));for(let e=0;e<o.length;e++)if(o[e].id==t.id){o.splice(e,1);break}t.url=n,o.unshift(t),localStorage.setItem("history",JSON.stringify(o))}catch(e){changePage("home"),addNotification("❌ An error occurred"),console.error(e)}}else addNotification("❌ Invalid TikTok URL");else addNotification("You are offline")},window.refreshHistory=function(){let e=JSON.parse(localStorage.getItem("history"))||[];if(null==e||0==e.length)return e=[],document.getElementsByClassName("videos-wrapper")[0].innerHTML="<div class='no-history'><i class='fas fa-history'></i>History is empty!</div>",void(document.getElementsByClassName("clear-history")[0]&&(document.getElementsByClassName("clear-history")[0].dataset.visible="hidden"));document.getElementsByClassName("videos-wrapper")[0].innerHTML="";for(let t=0;t<e.length;t++){let n=e[t],d=`\n                <div class="video" onclick="loadVideo('${n.url}')">\n                    <img src="${n.cover}" alt="">\n                    <div class="data">\n                        <div class="author">\n                            ${n.author.nickname}\n                        </div>\n                        <div class="description">\n                            ${formatDescription(n.title.length>100?n.title.substring(0,100)+"...":n.title)}\n                        </div>\n                        <div class="data-row">\n                            <div class="data-item">\n                                <i class="fas fa-eye"></i>\n                                    ${formatNumber(n.play_count)}\n                            </div>\n                            <div class="data-item">\n                                <i class="fas fa-heart"></i>\n                                    ${formatNumber(n.digg_count)}\n                            </div>\n                            <div class="data-item">\n                                <i class="fas fa-comment"></i>\n                                    ${formatNumber(n.comment_count)}\n                            </div>     \n                    </div>\n                </div>\n            `;document.getElementsByClassName("videos-wrapper")[0].innerHTML+=d,t==e.length-1&&(document.getElementsByClassName("videos-wrapper")[0].innerHTML+='\n                    <div class="clear-history" onclick="clearHistory()">\n                        <i class="fas fa-trash"></i>&nbsp;&nbsp;\n                        Clear history\n                    </div>\n                ')}},refreshHistory(),window.clearHistory=function(){confirm("Are you sure you want to clear your history?")&&(localStorage.setItem("history",JSON.stringify([])),refreshHistory(),addNotification("History cleared"))},window.changePage=function(e){switch(document.getElementById("img-content").innerHTML="",document.getElementById("img-data").style.display="none",document.getElementById("image-slideshow").style.display="none",e){case"home":window.history.pushState({},"","/"),document.getElementById("video").src="",refreshHistory(),"true"==document.getElementById("tn-popup").dataset.visible&&(document.getElementById("tn-popup").dataset.visible="false"),document.getElementById("video").pause(),document.getElementById("link").disabled=!1,document.getElementById("video-status").style.display="none",document.getElementById("p_home").dataset.visible="visible",document.getElementById("p_history").dataset.visible="hidden-right",document.getElementById("p_player").dataset.visible="hidden-right",document.getElementById("nav-menu").dataset.visible="true",document.getElementById("nav-player").dataset.visible="false",document.getElementById("m_home").dataset.selected="true",document.getElementById("m_history").dataset.selected="false";break;case"history":window.history.pushState({},"","/history"),document.getElementById("link").disabled=!0,document.getElementById("p_home").dataset.visible="hidden-left",document.getElementById("p_history").dataset.visible="visible",document.getElementById("p_player").dataset.visible="hidden-right",document.getElementById("nav-menu").dataset.visible="true",document.getElementById("nav-player").dataset.visible="false",document.getElementById("m_home").dataset.selected="false",document.getElementById("m_history").dataset.selected="true";break;case"player":document.getElementById("link").disabled=!0,document.getElementById("link").value="",document.getElementById("p_home").dataset.visible="hidden-left",document.getElementById("p_history").dataset.visible="hidden-left",document.getElementById("p_player").dataset.visible="visible",document.getElementById("nav-menu").dataset.visible="false",document.getElementById("nav-player").dataset.visible="true"}},"/history"==window.location.pathname)changePage("history");else if(window.location.pathname.startsWith("/video/")){let e=window.location.pathname.split("/")[2];loadVideo(e)}else changePage("home");window.togglePopup=function(e){"default"==e&&(e='\n                <div class="list-container">\n                    <div class="list-item" onclick="downloadVideo()">\n                        <! -- download --\x3e \n                        <i class="fas fa-download"></i> Download\n                    </div>\n                    <div class="list-item" onclick="shareVideo()">\n                        <! -- share --\x3e\n                        <i class="fas fa-share-alt"></i> Share\n                    </div>\n                    <div class="list-item" onclick="toggleClearMode()">\n                        <! -- clear mode --\x3e\n                        <i class="fas fa-sync-alt"></i> Clear Mode\n                    </div>\n                </div>\n            '),"true"==document.getElementById("tn-popup").dataset.visible?document.getElementById("tn-popup").dataset.visible="false":(document.getElementById("tn-popup").dataset.visible="true",navigator.vibrate(50),document.getElementById("tn-content").innerHTML=e)},window.shareVideo=function(){navigator.share({title:"TikNot",url:window.location.href}).then((()=>{})).catch(console.error)};document.addEventListener("touchstart",(function(e){n=e.changedTouches[0].screenX,i=e.changedTouches[0].screenY})),document.addEventListener("touchend",(function(e){if(d=e.changedTouches[0].screenX,a=e.changedTouches[0].screenY,"true"!=document.getElementById("tn-popup").dataset.visible)if("visible"==document.getElementById("p_home").dataset.visible)n>d+50&&Math.abs(i-a)<100&&changePage("history");else if("visible"==document.getElementById("p_history").dataset.visible)n<d-50&&Math.abs(i-a)<100&&changePage("home");else if("visible"==document.getElementById("p_player").dataset.visible&&"image"==document.getElementById("p_player").dataset.type)if(n<d-50&&Math.abs(i-a)<100){if(0==document.getElementById("image-slideshow").dataset.index)return;document.getElementById("image-slideshow").dataset.index=parseInt(document.getElementById("image-slideshow").dataset.index)-1,document.getElementById("img-content").style.transform=`translateX(-${100*document.getElementById("image-slideshow").dataset.index}vw)`,document.getElementById("img-current").innerHTML=Number(document.getElementById("image-slideshow").dataset.index)+1}else if(n>d+50&&Math.abs(i-a)<100){if(document.getElementById("image-slideshow").dataset.index==document.getElementById("img-content").children.length-1)return;document.getElementById("image-slideshow").dataset.index=parseInt(document.getElementById("image-slideshow").dataset.index)+1,document.getElementById("img-content").style.transform=`translateX(-${100*document.getElementById("image-slideshow").dataset.index}vw)`,document.getElementById("img-current").innerHTML=Number(document.getElementById("image-slideshow").dataset.index)+1}})),document.addEventListener("keydown",(function(e){if("visible"==document.getElementById("p_player").dataset.visible&&"image"==document.getElementById("p_player").dataset.type)if("ArrowLeft"==e.key){if(0==document.getElementById("image-slideshow").dataset.index)return;document.getElementById("image-slideshow").dataset.index=parseInt(document.getElementById("image-slideshow").dataset.index)-1,document.getElementById("img-content").style.transform=`translateX(-${100*document.getElementById("image-slideshow").dataset.index}vw)`,document.getElementById("img-current").innerHTML=Number(document.getElementById("image-slideshow").dataset.index)+1}else if("ArrowRight"==e.key){if(document.getElementById("image-slideshow").dataset.index==document.getElementById("img-content").children.length-1)return;document.getElementById("image-slideshow").dataset.index=parseInt(document.getElementById("image-slideshow").dataset.index)+1,document.getElementById("img-content").style.transform=`translateX(-${100*document.getElementById("image-slideshow").dataset.index}vw)`,document.getElementById("img-current").innerHTML=Number(document.getElementById("image-slideshow").dataset.index)+1}})),document.addEventListener("contextmenu",(function(e){e.shiftKey||"visible"==document.getElementById("p_player").dataset.visible&&(e.preventDefault(),"true"==document.getElementById("tn-popup").dataset.visible?togglePopup():togglePopup("default"))})),document.addEventListener("click",(function(e){"visible"==document.getElementById("p_player").dataset.visible&&("true"==document.getElementById("tn-popup").dataset.visible?togglePopup():"video"==e.target.id&&(document.getElementById("video").paused?document.getElementById("video").play():document.getElementById("video").pause()))}))}));const t=()=>{document.documentElement.style.setProperty("--doc-height",`${window.innerHeight}px`)};window.addEventListener("resize",t),t(),window.addEventListener("offline",(function(){addNotification("Unable to connect"),e=!1})),window.addEventListener("online",(function(){addNotification("Back online"),e=!0})),document.getElementById("video").addEventListener("pause",(function(){document.getElementById("video-status").dataset.playing="false"})),document.getElementById("video").addEventListener("play",(function(){document.getElementById("video-status").dataset.playing="true",setInterval((function(){document.getElementById("progress-bar").style.width=document.getElementById("video").currentTime/document.getElementById("video").duration*100+"%"}),1e3)})),window.formatNumber=function(e){return e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e4?(e/1e3).toFixed(1)+"k":e},window.formatDescription=function(e){return e=(e=e.replace(/#(\w+)/g,"<b>#$1</b>")).replace(/@(\w+)/g,"<b>@$1</b>")},window.toggleClearMode=function(){document.getElementsByClassName("ui-right")[0].dataset.clear="true"==document.getElementsByClassName("ui-right")[0].dataset.clear?"false":"true",document.getElementsByClassName("ui-bottom")[0].dataset.clear="true"==document.getElementsByClassName("ui-bottom")[0].dataset.clear?"false":"true",document.getElementById("clearModeToggle").dataset.active="true"==document.getElementById("clearModeToggle").dataset.active?"false":"true"},window.downloadVideo=function(){if(video){addNotification("✔️ Starting download...");let e=document.createElement("a");e.href=document.getElementById("video").src,e.download=video.id+"_tiknot.mp4",e.click()}};
